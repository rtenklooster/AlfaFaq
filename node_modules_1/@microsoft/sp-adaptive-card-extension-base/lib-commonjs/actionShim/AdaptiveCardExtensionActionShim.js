"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdaptiveCardExtensionActionShim = void 0;
var sp_diagnostics_1 = require("@microsoft/sp-diagnostics");
/**
 * A shim for brokering the actions between an ACE's renderer e.g., the ACE web part and isolated ACE application.
 * This removes redundant handling logic while also allowing for each handler renderer to behave differently at
 * specific steps of action handling.
 *
 * TODO: Kill switch using this shim in `BaseAdaptiveCardExtensionWebPart._handleAction`.
 *
 * @internal
 */
var AdaptiveCardExtensionActionShim = /** @class */ (function () {
    function AdaptiveCardExtensionActionShim(_ace, _provider) {
        var _this = this;
        this._ace = _ace;
        this._provider = _provider;
        this.handleAction = function (action) {
            var actionType = action.getJsonTypeName();
            switch (actionType) {
                case 'Action.OpenUrl':
                    _this._handleOpenUrl(action);
                    break;
                case 'Action.ShowCard':
                    _this._handleShowCard(action);
                    break;
                case 'Action.Submit':
                    _this._handleSubmit(action);
                    break;
                case 'VivaAction.GetLocation':
                    _this._handleGetLocation(action);
                    break;
                case 'VivaAction.SelectMedia':
                    _this._handleSelectMedia(action);
                    break;
                case 'VivaAction.ShowLocation':
                    _this._handleShowLocation(action);
                    break;
            }
        };
    }
    AdaptiveCardExtensionActionShim.prototype._handleGetLocation = function (action) {
        var _a;
        var monitor = new sp_diagnostics_1._QosMonitor('AdaptiveCardExtension._onExecuteAction.GetLocation', true);
        try {
            var params = {
                chooseLocationOnMap: (_a = action.parameters) === null || _a === void 0 ? void 0 : _a.chooseLocationOnMap
            };
            this._provider.getLocation(this._ace).getLocation(params);
            monitor.writeSuccess();
            this._provider.log(this._ace, 'VivaAction.GetLocation');
        }
        catch (error) {
            monitor.writeUnexpectedFailure(undefined, error);
        }
    };
    AdaptiveCardExtensionActionShim.prototype._handleOpenUrl = function (action) {
        var url = action.url;
        if (url) {
            this._provider.openUrl(this._ace, url);
            this._provider.log(this._ace, 'OpenUrl');
        }
    };
    AdaptiveCardExtensionActionShim.prototype._handleSelectMedia = function (action) {
        this._provider.selectMedia(this._ace, action).getMedia(action);
        this._provider.log(this._ace, 'VivaAction.SelectMedia');
    };
    AdaptiveCardExtensionActionShim.prototype._handleShowCard = function (action) {
        var actionArgs = {
            id: action.id,
            type: 'ShowCard'
        };
        this._provider.aceActionHandler(this._ace, actionArgs);
        this._provider.log(this._ace, 'ShowCard');
    };
    AdaptiveCardExtensionActionShim.prototype._handleShowLocation = function (action) {
        var _a;
        var monitor = new sp_diagnostics_1._QosMonitor('AdaptiveCardExtension._onExecuteAction.ShowLocation', true);
        try {
            var params = {
                locationCoordinates: (_a = action.parameters) === null || _a === void 0 ? void 0 : _a.locationCoordinates
            };
            this._provider.showLocation(this._ace).showLocation(params);
            monitor.writeSuccess();
            this._provider.log(this._ace, 'VivaAction.ShowLocation');
        }
        catch (error) {
            monitor.writeUnexpectedFailure(undefined, error);
        }
    };
    AdaptiveCardExtensionActionShim.prototype._handleSubmit = function (action) {
        var _this = this;
        var _a;
        var monitor = new sp_diagnostics_1._QosMonitor('AdaptiveCardExtension._onExecuteAction.handleConfirmationDialog', true);
        // Internally, a Submit action is used to open the quick view
        var viewId = (_a = action.data) === null || _a === void 0 ? void 0 : _a._internalQuickViewId;
        if (viewId) {
            this._provider.quickView(viewId);
        }
        else {
            var actionArgs_1 = {
                data: action.data,
                id: action.id,
                type: 'Submit'
            };
            this._provider
                .confirmationDialog(actionArgs_1)
                .then(function (isCancelled) {
                monitor.writeSuccess();
                if (!isCancelled) {
                    _this._provider.aceActionHandler(_this._ace, actionArgs_1);
                    _this._provider.log(_this._ace, 'Submit');
                }
            })
                .catch(function () {
                monitor.writeUnexpectedFailure();
            });
        }
    };
    return AdaptiveCardExtensionActionShim;
}());
exports.AdaptiveCardExtensionActionShim = AdaptiveCardExtensionActionShim;
//# sourceMappingURL=AdaptiveCardExtensionActionShim.js.map